(function(){"use strict";function n(n,t,e){return 0>e||e>=n.length?"#":0>t||t>=n[e].length?"#":n[e][t]}function t(n,t,i,o){return 0>i||i>=n.length?!1:0>t||t>=n[i].length?!1:(n[i]=e(n[i],t,o),!0)}function e(n,t,e){return n.substr(0,t)+e+n.substr(t+1)}function i(t,e,i,o,c,a){var u=n(t,e,i),f=0>o?"[{(":"]})";return!u||f.indexOf(u)<0?c(t,e,i,a):et(t,it[u],function(n,e,i){return c(t,e+o,i,a)})}function o(t,e,o,c){return i(t,e,o,c,n)}function c(n,e,o,c,a){return i(n,e,o,c,t,a)}function a(e,i){for(var a;a=f(e,i);){var u=a[0],r=a[1];"v"===n(e,u,r-1)?(t(e,u,r-1," "),t(i,u,r,"v")):">"===o(e,u-1,r,-1)?(c(e,u-1,r,-1," "),t(i,u,r,">")):"<"===o(e,u+1,r,1)?(c(e,u+1,r,1," "),t(i,u,r,"<")):"^"===n(e,u,r+1)&&(t(e,u,r+1," "),t(i,u,r,"^"))}}function u(n){return n?" "===n:!0}function f(t,e){var i;return _(t,function(c,a,f){return!i&&u(c)&&u(n(e,a,f))?">"===o(t,a-1,f,-1)?i=[a,f]:"<"===o(t,a+1,f,1)?i=[a,f]:"v"===n(t,a,f-1)?i=[a,f]:"^"===n(t,a,f+1)?i=[a,f]:void 0:void 0}),i}function r(e,i){for(var o;o=l(e,i);){var c=o[0],a=o[1],u=n(e,c,a);">"===u&&t(i,c,a,"<"),"<"===u&&t(i,c,a,">"),"^"===u&&t(i,c,a,"v"),"v"===u&&t(i,c,a,"^")}}function v(n,t){return n!==t&&t?-1===" @[]{}()".indexOf(t):!1}function l(t,e){for(var i=0;i<t.length;i++)for(var o=0;o<t[i].length;o++)if(" "===n(e,o,i)){var c=n(t,o,i),a=o,u=i;if(-1!=="<>^v".indexOf(c)){">"===c&&a++,"<"===c&&a--,"^"===c&&u--,"v"===c&&u++;var f=n(t,a,u),r=n(e,a,u);if(v(c,f)||v(c,r))return[o,i]}}}function d(n,e){_(n,function(n,i,o){"[]{}()".indexOf(n)>-1&&t(e,i,o,n)})}function s(e,i,o,c){" "===n(e,o,c)&&t(i,o,c,".")}function m(n,t,e,i,a){" "===o(n,e,i,a)&&c(t,e,i,a,".")}function O(n,t){at(n,"O",function(e,i){m(n,t,e-1,i,-1),m(n,t,e+1,i,1),s(n,t,e,i-1),s(n,t,e,i+1)})}function h(n,e,i,o){_(n,function(n,c,a){n===i&&t(e,c,a,o)})}function A(e,i,o){-1!=="abcdexyz".indexOf(n(e,i,o))&&t(e,i,o," ")}function C(n,t,e){var i=!1,o=!1;et(n,t.toUpperCase(),function(){i=!0}),et(n,t.toLowerCase(),function(){o=!0}),i&&o||e()}function b(n,t){C(n,t,function(){ft(n,t.toUpperCase()," "),ft(n,t.toLowerCase()," ")})}function x(n,t){C(n,t,function(){at(n,t.toUpperCase(),B)})}function B(n,t,e,i){D(i,e,n,t,-1,0),D(i,e,n,t,1,0),D(i,e,n,t,0,-1),D(i,e,n,t,0,1)}function D(e,i,o,c,a,u){for(var f,r=o,v=c;;)if(r+=a,v+=u,f=n(e,r,v)," ".indexOf(f)<0){if(f!==i)return;break}for(o+=a,c+=u,o>r&&(f=o,o=r,r=f,a=-a),c>v&&(f=c,c=v,v=f,u=-u);r>o||v>c;o+=a,c+=u)t(e,o,c,i),B(i,o,c,e)}function Z(n){at(n,"-|",function(e,i){t(n,e,i," ")})}function g(t){at(t,"+",function(e,i){("0"===n(t,e-1,i)||"0"===n(t,e+1,i)||"0"===n(t,e,i-1)||"0"===n(t,e,i+1))&&y(t,e,i)})}function y(n,t,e){p(n,t,e,-1,0),p(n,t,e,1,0),p(n,t,e,0,-1),p(n,t,e,0,1)}function p(e,o,c,a,u){for(var f;;){if(o+=a,c+=u,0===u&&i(e,o,c,a,function(n,t,e){o=t,c=e}),f=n(e,o,c),!(" <>^vOo.@".indexOf(f)>-1)){"+"===f&&y(e,o,c);break}t(e,o,c,0===a?"|":"-")}}function X(n){return-1==="#ABCDEXYZ[]{}()".indexOf(n)}function E(n,e,i){return et(n.slice(),"@",function(n,c,a,u){return X(o(u,c+e,a+i,e))?(t(u,c,a," "),[c,a,u]):!1})}function w(n,t,e,i,a,u){t=t.slice();var f=!1,r=o(n,e+a,i+u,a),v=o(t,e+a,i+u,a);return-1!==" =".indexOf(v)&&(f=!0),1===a&&"<"===r&&(f=!1),-1===a&&">"===r&&(f=!1),1===u&&"^"===r&&(f=!1),-1===u&&"v"===r&&(f=!1),f&&c(t,e+a,i+u,a,"@"),t}function I(n){return"#"===n?"wall":"@"===n?"hero":"="===n?"exit":" "===n?"space":"><^vOo.".indexOf(n)>-1?"enemy":"abcdexyz".indexOf(n)>-1?"key":"ABCDEXYZ".indexOf(n)>-1?"door":"[]{}()".indexOf(n)>-1?"portal":"0123".indexOf(n)>-1?"counter":"+-|".indexOf(n)>-1?"laser":n}function k(n){return'<i class="c-'+I(n)+'">'+n+"</i>"}function Y(n){return n.split("").map(k).join("")}function z(n){return n.map(Y).join("")}function T(n){return"<b>"+n+"</b>"}function j(n,t){var e=document.getElementById("stage");e.innerHTML=z(n)+T(t),e.style.width=1.5*n[0].length+"em",e.style.marginLeft=-(.75*n[0].length)+"em",e.style.marginTop=-(.75*n.length)+"em"}function L(n){mt.push(n)}function M(){try{Ot=localStorage.getItem("level")||0}catch(n){Ot=0}R()}function S(n,t,e){q(e)||U()||n*t===0&&1===Math.abs(n+t)&&($=dt($,n,t),W()&&(V="I died."),F()&&(V="I made it."))}function U(){return W()||F()?(F()&&H(1),H(0),!0):void 0}function H(n){Ot+=n,R();try{localStorage.setItem("level",Ot)}catch(t){}}function q(n){69===n&&H(1),82===n&&H(0),81===n&&H(-1)}function P(){return[$.slice(),V]}function R(){Ot=Math.max(0,Math.min(mt.length-1,Ot)),$=mt[Ot].data,V=mt[Ot].title}function W(){return-1===$.join("").indexOf("@")}function F(){return-1===$.join("").indexOf("=")}function G(n){switch(n){case 38:case 87:case 75:return[0,-1,0];case 40:case 83:case 74:return[0,1,0];case 37:case 65:case 72:return[-1,0,0];case 39:case 68:case 76:return[1,0,0]}}function J(n){document.addEventListener("keydown",function(t){var e=G(t.keyCode);e?n.apply(null,e):n(0,0,t.keyCode)})}function K(){st.apply(null,P())}function N(n){return n.map(function(n,t){return t?"         "+n:n}).join("\n")}function Q(n,t,e,i){Ct(n,t,function(){return rt(n,e,i)})}var V,$,_=function(t,e){for(var i=0;i<t.length;i++)for(var o=0;o<t[i].length;o++)e(n(t,o,i),o,i,t);return t},nt=function(n,e){_(n,function(i,o,c){t(n,o,c,e)})},tt=function(n,e){_(e,function(e,i,o){e&&" "!==e&&t(n,i,o,e)})},et=function(n,t,e){var i=null;return _(n,function(o,c,a){t!==o||i||(i=e(o,c,a,n))}),i},it={"{":"}","[":"]","(":")","}":"{","]":"[",")":"("},ot=function(n){var t=n.slice(),e=n.slice();return nt(e," "),a(t,e),tt(t,e),t},ct=function(n){var t=n.slice(),e=n.slice();return nt(e," "),r(t,e),tt(t,e),t},at=function(n,t,e){_(n,function(i,o,c){t.indexOf(i)>-1&&e(o,c,i,n)})},ut=function(n){var t=n.slice(),e=n.slice();return nt(e," "),d(t,e),O(t,e),h(t,e,"o","O"),h(t,e,".","o"),tt(t,e),t},ft=function(n,e,i){at(n,e,function(e,o){t(n,e,o,i)})},rt=function(n,t,e){return n=n.slice(),A(n,t,e),"abcde".split("").forEach(function(t){b(n,t)}),"xyz".split("").forEach(function(t){x(n,t)}),n},vt=function(n){return _(n.slice(),function(n,e,i,o){"0123".indexOf(n)>-1&&t(o,e,i,""+(+n+3)%4)})},lt=function(n){return n=n.slice(),Z(n),g(n),n},dt=function(n,t,e){var i=n,o=E(n,t,e);return o?(i=o[2],i=rt(i,o[0]+t,o[1]+e),i=ot(i),i=ct(i),i=ut(i),i=vt(i),i=lt(i),i=w(n,i,o[0],o[1],t,e)):i},st=j,mt=[],Ot=0;L({name:"01",title:"I awoke and ran to the door.",data:["           "," @       = ","           "]}),L({name:"02",title:"I'm in a hallway.",data:["    #   #  ","#@# # # #=#","  #   #    "]}),L({name:"03",title:"TODO: Story 1",data:["   #   ## ##   #   "," @     #       # = ","   #   ## ##   #   ","# ####### ### ### #","   ## ##   ## ##   ","   #       #   #   ","   ## ##   ## ##   ","# ### ### ### ### #","   #   ## ##   #   ","       #           ","   #   ## ##   #   "]}),L({name:"04",title:"I don't want to die.",data:["     >     "," @       = ","     <     "]}),L({name:"05",title:"More guards.",data:["## v     ##","##   v   ##","@      v = ","##       ##","##       ##"]}),L({name:"06",title:"I'll sneak behind them.",data:["## v@  ##","##   ^ ##","## ### ##","   v v   "," ^     ^ "," ###=### ","         "]}),L({name:"07",title:"Oh, they have buddies now.",data:["   v  v  ="," #       #"," #      ##"," #    ^###"," #    ####","@# ^ #####"]}),L({name:"08",title:"TODO: Story 2",data:["           "," @       = ","           "]}),L({name:"09",title:"Hmm...",data:["#####  @ A=","##### #####","a     #####"]}),L({name:"10",title:"",data:["bA ##vC=","## ## ##",">     @ ","## ## ##","## ## ##","       <","## ## ##","a ^## Bc"]}),L({name:"12",title:"",data:["v@      <       <"," ############### "," #v           <# "," # ######## ## # "," # #v       <# # "," # # ## #### # # "," # # #v   <#   # "," # # # ### # # # ","v# # #  =# # # #^"," # # # ### # # # ","   # #>   ^# # # "," # # ####### # # "," # #>       ^# # "," # ######## ## # "," #>           ^# "," ## ############ ",">       >       ^"]}),L({name:"13",title:"It's not that scary.",data:["##   @   ##","# >       #","       <   ","   >       "," <##>  ## <","> #a# #=#> "," > B   A   ","#    #    #","##  #b#  ##","##       ##","##       ##","##^#^#^#^##"]}),L({name:"14",title:"Ooh, some of these.",data:["     #     "," @ ] # [ { ","     #     ","###########"," )   #     ","     # ( = ","   } #     "]}),L({name:"15",title:"What am I, a frog?",data:["          =         ","############# ######","{ >>> > > > >>> > >)","####################","( > > >>> > >>> > >}","############# ######","[<< < <<  <  <  << ]","          @    <    "]}),L({name:"16",title:"",data:["   # #   # A   ","( =# #c{ # # b "," ^ # #   # #   ","#### ##### ####","@   v     ^   ]","#### ##### ####","   # #   # #   ","a[ # # } # # ) ","   # B   # C   "]}),L({name:"18",title:"",data:["(   ] {   )","@   ] {    ","###########","[v###=###v}","# bA# #Ba #","# #BA BA# #"]}),L({name:"20",title:"TODO: REDO\nPlague of death.",data:["O          ","########=# "," @ #   ### "," # # # #   "," #   #   ##"]}),L({name:"21",title:"These bio-labs creep me out.",data:["@          ","########## ","         # ","[ .     }# ","         # ","########## ","         # ","{       ]# ","         # ","########## ","=          "]}),L({name:"22",title:"",data:[" v  v  v  v            O"," v  v  v  v             "," v     v                "," v  ^  v  ^#         o  "," v  ^  v  ^# ###########",".v  ^  v  ^#           ="," v  ^  v  ^# ###########","    ^  v  ^#          o "," ^  ^  v  ^#            "," ^  ^     ^#            ","@^  ^  ^  ^#     O     ."]}),L({name:"23",title:"",data:["##############.oOo.","                @  "," ################# "," #C C# D #   # B## "," # ###C# #DAD#C#D# "," # AD# #C#BAD# #B# "," #C#D# # #DAD# #D# "," # C #DCB#   #C ## "," ################# ","         bdBD AAaa ","#############c#####","#############=#####"]}),L({name:"24",title:"",data:["a@A=","# ##","a A<","# ##","a A<","# ##","a A<"]}),L({name:"25",title:"",data:[".@ Ba#bCc# #      =","## # A # D ### ####","a# Cb#cCc# #     < "," # # C # C ##### ##"," # Aa#cAd# # >     "," # # C # A ### ####","   Ba#cCc# #     < "," # # D # B ##### ##","b#  b#dBb# ABCD    "]}),L({name:"27",title:"",data:["####3####","    +    ","       < ","      @<=","       < "]}),L({name:"28",title:"",data:["# +       + #","#   #####   #","1   #   #   3","+ + + + + + +","= #   #   #  ","  #   #   #@ ","    +   +   +"]}),L({name:"33",title:"",data:["   >      "," #AZBYCX##"," #       ="," #AZBYCX##","          ","##### ### ","##### c x ","####### ##","@ azby    "]}),L({name:"40",title:"",data:["@    v           v     v     ","  ^     ^  ^  ^     ^     ^  "," <# <# <#> # <# <# <# <#> #> ","        v  v        v        ","  ^  ^        ^  ^     ^  ^  ","> #> # <# <#> #> #> #> # <# <","     v  v           v  v     ","  ^        ^  ^  ^        ^  ","> # <# <#> #> #> # <#> #> #> ","  v              v        v  ","     ^  ^  ^  ^     ^  ^     "," <#> #> # <#> # <#> # <# <#> ","     v  v  v  v     v  v     ","  ^              ^        ^  "," <# <#> # <#> #> # <# <#> #> ","  v     v     v  v  v        ","     ^     ^           ^  ^ ="]});var ht=J;ht(function(n,t,e){S(n,t,e),K()}),setTimeout(function(){M(),K()},0);var At=function(n,t,e){if(n!==t)throw new Error(e)},Ct=function(n,t,e){var i=N(e(n));n=N(n),t=N(t),At(i,t,"\nexpected "+n+"\n\nto equal "+t+"\n\nbut was  "+i+"\n")},bt=function(n){for(var t=0;t<n.length-1;t++)Ct(n[t][0],n[t+1][0],function(e){return dt(e,n[t][1],n[t][2])})},xt=0,Bt=0,Dt=function(n){try{n(),xt++}catch(t){console.log(t.stack),Bt++}};setTimeout(function(){console.log(""+xt+" passed : "+Bt+" failed")},0),Dt(function(){Ct(["0123"],["3012"],vt)}),Dt(function(){Ct(["0123","1230","2301","3012"],["3012","0123","1230","2301"],vt)}),Dt(function(){Ct(["         "," .  o  O ","         "],["       . "," o  O .O.","       . "],ut)}),Dt(function(){Ct(["      [  ","{O]      ","      }  "],[" .    [. ","{O]      "," .   .}  "],ut)}),Dt(function(){Ct(["v > "," ^ <"],[" ^ >","v < "],ot)}),Dt(function(){Ct([">> ","<< "],[" >>","<< "],ot)}),Dt(function(){Ct(["    "," >v "," ^< ","    "],["    "," >v "," ^< ","    "],ot)}),Dt(function(){Ct([">>>v","^>vv","^^ v","^^<<"],["^>>>","^^>v","^^vv"," <<v"],ot)}),Dt(function(){Ct([" v ","> <"," ^ "],["   ",">v<"," ^ "],ot)}),Dt(function(){Ct(["> <"," ^ "],[" ><"," ^ "],ot)}),Dt(function(){Ct([" <","^ "],["< ","^ "],ot)}),Dt(function(){Ct([" [<   ] "," (   >) ",">}    { "],[" [   <] "," (>   ) "," }    {>"],ot)}),Dt(function(){Ct(["vv^^","><><"],["^^vv","<><>"],ct)}),Dt(function(){Ct(["    "," v< "," >^ ","    "],["    "," ^> "," <v ","    "],ct)}),Dt(function(){Ct(["^ >>","^   ","   v","<< v"],["v <<","v   ","   ^",">> ^"],ct)}),Dt(function(){Ct(["v <<","v   ","   ^",">> ^"],["v <<","v   ","   ^",">> ^"],ct)}),Dt(function(){Ct([">A ","B>C","  ^","E<D"],["<A ","B<C","  v","E>D"],ct)}),Dt(function(){Ct(["<A ","B<C","  v","E>D"],[">A ","B>C","  ^","E<D"],ct)}),Dt(function(){Ct([">a ","b>c","  ^","e<d"],["<a ","b<c","  v","e>d"],ct)}),Dt(function(){Ct(["<a ","b<c","  v","e>d"],[">a ","b>c","  ^","e<d"],ct)}),Dt(function(){Ct(["  0  ","  +  ","     ","     "],["  0  ","--+--","  |  ","  |  "],lt)}),Dt(function(){Ct([" 0 + "," +   ","     "," +   "],[" 0 + ","-+---"," |   ","-+---"],lt)}),Dt(function(){Ct([" 0   "," +  ]","  [  "],[" 0   ","-+--]"," |[--"],lt)}),Dt(function(){Ct([" 0        "," + ><^v @ ","          "," O        "," o        "," .        ","          "],[" 0        ","-+--------"," |        "," |        "," |        "," |        "," |        "],lt)}),Dt(function(){Ct([" 1   ","-+---"," |   "],[" 1   "," +   ","     "],lt)}),Dt(function(){bt([[["   ","   ","   "],0,1],[["   ","   ","   "],0,-1],[["   ","   ","   "],1,0],[["   ","   ","   "],-1,0],[["   ","   ","   "]]])}),Dt(function(){bt([[["   "," @ ","   "],0,1],[["   ","   "," @ "],0,1],[["   ","   "," @ "],1,0],[["   ","   ","  @"],1,0],[["   ","   ","  @"],0,-1],[["   ","  @","   "],0,-1],[["  @","   ","   "],0,-1],[["  @","   ","   "],-1,0],[[" @ ","   ","   "],-1,0],[["@  ","   ","   "],-1,0],[["@  ","   ","   "]]])}),Dt(function(){bt([[["# #"," @ "," # "],0,1],[["# #"," @ "," # "],1,0],[["# #","  @"," # "],0,-1],[["# #","  @"," # "],-1,0],[["# #"," @ "," # "],0,-1],[["#@#","   "," # "],-1,0],[["#@#","   "," # "]]])}),Dt(function(){bt([[["   "," @v"," # "],0,1],[["   "," @v"," # "],-1,0],[["   ","@  "," #^"],0,-1],[["@  ","  ^"," # "],0,-1],[["@  ","  ^"," # "],0,1],[["  v","@  "," # "],0,1],[["   ","  v","@# "]]])}),Dt(function(){bt([[[" > "," @ "," # "],0,1],[[" > "," @ "," # "],-1,0],[["  <","@  "," # "],0,1],[[" < ","   ","@# "],0,-1],[[">  ","@  "," # "],0,1],[[" > ","   ","@# "],0,-1],[["  <","@  "," # "]]])}),Dt(function(){bt([[[">   <","@    "],1,0],[[" > < "," @   "],1,0],[["  <> ","  @  "],1,0],[[" <  <","   @ "],1,0],[[">  < ","    @"],-1,0],[[" <>  ","   @ "],-1,0],[[">  > ","  @  "],-1,0],[[" >  <"," @   "],-1,0],[["  <> ","@    "]]])}),Dt(function(){bt([[["@  <"],1,0],[[" @< "],1,0],[[" <  "]]])}),Dt(function(){bt([[[">>   #     ",">>>  #     ",">>>> #     ","   <<#     ","  <<<#     ","###########","     #     ","     #     ","     #  @  ","     #     ","     #     "],1,0],[[" >>  #     "," >>> #     "," <<<<#     ","  << #     "," <<< #     ","###########","     #     ","     #     ","     #   @ ","     #     ","     #     "],-1,0],[["  >> #     ","  <<<#     ",">>>> #     "," <<  #     ",">>>  #     ","###########","     #     ","     #     ","     #  @  ","     #     ","     #     "]]])}),Dt(function(){bt([[[" >@"],-1,0],[["  <"]]])}),Dt(function(){bt([[["a@A="],1,0],[["a@A="],-1,0],[["@  ="],1,0],[[" @ ="],1,0],[["  @="],1,0],[["   @"]]])}),Dt(function(){bt([[["}@] [ ) ( <"],-1,0],[["}@] [ ) ( <"],1,0],[["} ] [@) (< "],1,0],[["} ] [<) (  "]]])}),Dt(function(){bt([[["2+ > .oO"," v <    ","       @"," +      "],0,1],[["1+  <oOO","  <    ."," ^      "," +     @"],0,-1],[["0+------"," |    .o"," |     @","-+------"],0,1],[["3+      ","      oO","        "," +     @"],0,1]])}),Dt(function(){Q(["aA bB cC dD eE"],["aA bB cC dD eE"],2,0)}),Dt(function(){Q([" A  B  C  D  E"],["              "],2,0)}),Dt(function(){Q(["a  b  c  d  e "],["              "],2,0)}),Dt(function(){Q([" a AAA"],["      "],1,0)}),Dt(function(){Q([" z Z Z"],["   ZZZ"],1,0)}),Dt(function(){Q(["   Z Z"," z    ","   Z Z"],["   ZZZ","   ZZZ","   ZZZ"],1,1)}),Dt(function(){Q(["   XYZ","xyz   ","   XYZ"],["   XYZ","x z Y ","   XYZ"],1,1)}),Dt(function(){Q(["xX     X"],[" XXXXXXX"],0,0)})}).call(this);